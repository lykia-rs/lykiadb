#[name=single, run=plan]>

SELECT id FROM books b GROUP BY id;

---

- project [id as id]
  - aggregate [group_by=[id], aggregates=[]]
    - scan [books as b]

#[name=multiple, run=plan]>

SELECT release_year AS yr FROM books b GROUP BY release_year, publisher_id;

---

- project [release_year as yr]
  - aggregate [group_by=[release_year, publisher_id], aggregates=[]]
    - scan [books as b]

#[name=with_1_aggregate, run=plan]>
SELECT publisher_id, release_year AS yr, avg(rating) AS avg_rating, avg(rating) AS avg_rating_dup FROM books b GROUP BY release_year, publisher_id ORDER BY yr;

---
- order [(yr, Asc)]
  - project [publisher_id as publisher_id, release_year as yr, avg(rating) as avg_rating, avg(rating) as avg_rating_dup]
    - aggregate [group_by=[release_year, publisher_id], aggregates=[avg(rating)]]
      - scan [books as b]

#[name=with_2_aggregates, run=plan]>
SELECT publisher_id, release_year AS yr, avg(rating) AS avg_rating, avg(rating + 1) AS avg_rating_plus FROM books b GROUP BY release_year, publisher_id ORDER BY yr;

---
- order [(yr, Asc)]
  - project [publisher_id as publisher_id, release_year as yr, avg(rating) as avg_rating, avg((rating Add Num(1.0))) as avg_rating_plus]
    - aggregate [group_by=[release_year, publisher_id], aggregates=[avg((rating Add Num(1.0))), avg(rating)]]
      - scan [books as b]


#[name=having, run=plan]>

SELECT publisher_id FROM books GROUP BY publisher_id HAVING avg(rating) > 3.0;

---

- filter [(avg(rating) Greater Num(3.0))]
  - project [publisher_id as publisher_id]
    - aggregate [group_by=[publisher_id], aggregates=[avg(rating)]]
      - scan [books as books]


#[name=having_without_group_by, run=plan]>
SELECT avg(rating) FROM books HAVING avg(rating) > 3.0;

---

- filter [(avg(rating) Greater Num(3.0))]
  - project [avg(rating) as avg(rating)]
    - aggregate [group_by=[], aggregates=[avg(rating)]]
      - scan [books as books]

#[name=having_with_regular_value, run=plan]>
SELECT avg(rating) FROM books HAVING anything > 10;

---

- filter [(anything Greater Num(10.0))]
  - project [avg(rating) as avg(rating)]
    - aggregate [group_by=[], aggregates=[avg(rating)]]
      - scan [books as books]


#[name=aggregations_with_regular_functions, run=plan]>
SELECT avg(rating), capitalize("id=" + id) as id_label FROM books group by id;

---

- project [avg(rating) as avg(rating), capitalize((Str("id=") Add id)) as id_label]
  - aggregate [group_by=[id], aggregates=[avg(rating)]]
    - scan [books as books]